<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pruning &mdash; Intel® Extension for Transformers 0.1.dev1+gc5ab7db documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=68dfede1" />

  
<script type="text/javascript">
  // Configure TMS settings
  window.wapProfile = 'profile-microsite'; // This is mapped by WAP authorize value
  window.wapLocalCode = 'us-en'; // Dynamically set per localized site, see mapping table for values
  window.wapSection = "intel-extension-for-transformers"; // WAP team will give you a unique section for your site
  window.wapEnv = 'prod'; // environment to be use in Adobe Tags.
  // Load TMS
  (() => {
        let url = 'https://www.intel.com/content/dam/www/global/wap/main/wap-microsite.js';
        let po = document.createElement('script'); po.type = 'text/javascript'; po.async = true; po.src = url;
        let s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  }) ();
</script>

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="AutoDistillation Design" href="autodistillation.html" />
    <link rel="prev" title="Distillation" href="distillation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Intel® Extension for Transformers
          </a>
            <div class="version">
              <a href="../../versions.html">latest▼</a>
              <p>Click link above to switch version</p>
            </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="get_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../user_guide.html">User Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../feature.html">Features</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="quantization.html">Quantization</a></li>
<li class="toctree-l3"><a class="reference internal" href="distillation.html">Distillation</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Pruning</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pruning-types">Pruning types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="autodistillation.html">AutoDistillation Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="data_augmentation.html">Data Augmentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="benchmark.html">Benchmark</a></li>
<li class="toctree-l3"><a class="reference internal" href="export.html">Export to ONNX</a></li>
<li class="toctree-l3"><a class="reference internal" href="metrics.html">Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="objectives.html">Objective</a></li>
<li class="toctree-l3"><a class="reference internal" href="pipeline.html">Pipeline</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../neural_engine.html">Neural Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kernel.html">Kernels</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../example.html">Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_doc/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="SECURITY.html">Security Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="release.html">Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="legal.html">Legal Information</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/intel/intel-extension-for-transformers">Repo</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Intel® Extension for Transformers</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../user_guide.html">User Guide</a></li>
          <li class="breadcrumb-item"><a href="../feature.html">Features</a></li>
      <li class="breadcrumb-item active">Pruning</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/docs/pruning.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pruning">
<h1>Pruning<a class="headerlink" href="#pruning" title="Link to this heading"></a></h1>
<ol class="simple">
<li><p><a class="reference external" href="#introduction">Introduction</a></p></li>
<li><p><a class="reference external" href="#pruning-types">Pruning types</a></p></li>
<li><p><a class="reference external" href="#usage">Usage</a></p></li>
</ol>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>Pruning is the process of removing redundant parameters of a network. The idea bears similarity to the <a class="reference external" href="http://yann.lecun.com/exdb/publis/pdf/lecun-90b.pdf">“optimal brain damage”</a> hypothesis by Yann LeCun. There are two types of pruning: Unstructured and Structured. Unstructured pruning means finding and removing the less salient connection in the model, the place could be anywhere in the matrix. Structured pruning means deleting entire blocks, filters, or channels.</p>
</section>
<section id="pruning-types">
<h2>Pruning types<a class="headerlink" href="#pruning-types" title="Link to this heading"></a></h2>
<p>There are three pruning types in Intel® Extension for Transformers:</p>
<ul class="simple">
<li><p>Magnitude (Unstructured)</p>
<ul>
<li><p>The algorithm prunes the weight by the lowest absolute value at each layer with a given sparsity target.</p></li>
</ul>
</li>
<li><p>Group Lasso (Structured)</p>
<ul>
<li><p>The algorithm uses Group lasso regularization to prune entire rows, columns, or blocks of parameters that result in a smaller dense network.</p></li>
</ul>
</li>
<li><p>Pattern Lock (Unstructured &amp; Structured)</p>
<ul>
<li><p>The algorithm locks the sparsity pattern in fine tune phase by freezing those zero values of the weight tensor during the weight update of training.</p></li>
</ul>
</li>
</ul>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Link to this heading"></a></h2>
<section id="script">
<h3>Script:<a class="headerlink" href="#script" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="kn">from</span> <span class="nn">intel_extension_for_transformers.transformers</span> <span class="kn">import</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">objectives</span><span class="p">,</span> <span class="n">PrunerConfig</span><span class="p">,</span> <span class="n">PruningConfig</span><span class="p">,</span>
<span class="kn">from</span> <span class="nn">intel_extension_for_transformers.transformers.trainer</span> <span class="kn">import</span> <span class="n">NLPTrainer</span>
<span class="c1"># Replace transformers.Trainer with NLPTrainer</span>
<span class="c1"># trainer = transformers.Trainer(......)</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">NLPTrainer</span><span class="p">(</span><span class="o">......</span><span class="p">)</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">Metric</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;eval_accuracy&quot;</span><span class="p">)</span>
<span class="n">pruner_config</span> <span class="o">=</span> <span class="n">PrunerConfig</span><span class="p">(</span><span class="n">prune_type</span><span class="o">=</span><span class="s1">&#39;BasicMagnitude&#39;</span><span class="p">,</span> <span class="n">target_sparsity_ratio</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
<span class="n">p_conf</span> <span class="o">=</span> <span class="n">PruningConfig</span><span class="p">(</span><span class="n">pruner_config</span><span class="o">=</span><span class="p">[</span><span class="n">pruner_config</span><span class="p">],</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">prune</span><span class="p">(</span><span class="n">pruning_config</span><span class="o">=</span><span class="n">p_conf</span><span class="p">)</span>
</pre></div>
</div>
<p>Please refer to <a class="reference external" href="../examples/huggingface/pytorch/text-classification/pruning">example</a> for the details.</p>
</section>
<section id="create-an-instance-of-metric">
<h3>Create an instance of Metric<a class="headerlink" href="#create-an-instance-of-metric" title="Link to this heading"></a></h3>
<p>The Metric defines which metric will be used to measure the performance of tuned models.</p>
<ul>
<li><p>example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">Metric</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;eval_accuracy&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Please refer to <a class="reference external" href="metrics.html">metrics document</a> for the details.</p>
</li>
</ul>
</section>
<section id="create-list-of-an-instance-of-prunerconfig-optional">
<h3>Create list of an instance of PrunerConfig(Optional)<a class="headerlink" href="#create-list-of-an-instance-of-prunerconfig-optional" title="Link to this heading"></a></h3>
<p>PrunerConfig defines which pruning algorithm to use and how to apply it during the training process. Intel® Extension for Transformers supports pruning types “BasicMagnitude”, “PatternLock”, and “GroupLasso”. You can create different pruners for different layers.</p>
<ul>
<li><p>arguments:
|Argument   |Type       |Description                                        |Default value    |
|:———-|:———-|:———————————————–|:—————-|
|epoch_range|list of integer|Which epochs to pruning                     |[0, 4]           |
|initial_sparsity_ratio|float |Initial sparsity goal                     |0.0              |
|target_sparsity_ratio|float  |Target sparsity goal                      |0.97             |
|update_frequency|integer|Frequency to updating sparsity                 |1                |
|prune_type|string|Pruning algorithm                                     |’BasicMagnitude’ |
|method|string|Pruning method                                            |’per_tensor’ |
|names|list of string|List of weight name to be pruned. If no weight is specified, all weights of the model will be pruned|[]|
|parameters|dict of string|The hyper-parameters for pruning, refer to <a class="reference external" href="https://github.com/intel/neural-compressor/blob/master/docs/source/pruning.html">the link</a>|None|</p></li>
<li><p>example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pruner_config</span> <span class="o">=</span> <span class="n">PrunerConfig</span><span class="p">(</span><span class="n">prune_type</span><span class="o">=</span><span class="s1">&#39;BasicMagnitude&#39;</span><span class="p">,</span> <span class="n">target_sparsity_ratio</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="create-an-instance-of-pruningconfig">
<h3>Create an instance of PruningConfig<a class="headerlink" href="#create-an-instance-of-pruningconfig" title="Link to this heading"></a></h3>
<p>The PruningConfig contains all the information related to the model pruning behavior. If you have created Metric and PrunerConfig instance, then you can create an instance of PruningConfig. Metric and pruner are optional.</p>
<ul>
<li><p>arguments:
|Argument   |Type       |Description                                        |Default value    |
|:———-|:———-|:———————————————–|:—————-|
|framework  |string     |Which framework you used                        |”pytorch”        |
|initial_sparsity_ratio|float |Initial sparsity goal, if pruner_config argument is defined, it didn’t need                       |0.0|
|target_sparsity_ratio|float |Target sparsity goal, if pruner argument is defined, it didn’t need                       |0.97|
|metrics    |Metric    |Used to evaluate accuracy of tuning model, no need for NoTrainerOptimizer|None    |
|pruner_config |PrunerConfig    |Defined pruning behavior, if it is None, then NLP will create a default a pruner with ‘BasicMagnitude’ pruning type                                  |None              |</p></li>
<li><p>example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pruning_conf</span> <span class="o">=</span> <span class="n">PruningConfig</span><span class="p">(</span><span class="n">pruner_config</span><span class="o">=</span><span class="p">[</span><span class="n">pruner_config</span><span class="p">],</span> <span class="n">metrics</span><span class="o">=</span><span class="n">tune_metric</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="prune-with-trainer">
<h3>Prune with Trainer<a class="headerlink" href="#prune-with-trainer" title="Link to this heading"></a></h3>
<ul>
<li><p>Prune with Trainer
NLPTrainer inherits from <code class="docutils literal notranslate"><span class="pre">transformers.Trainer</span></code>, so you can create a trainer like what you do in transformers examples. Then you can prune model with <code class="docutils literal notranslate"><span class="pre">trainer.prune</span></code> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">prune</span><span class="p">(</span><span class="n">pruning_config</span><span class="o">=</span><span class="n">pruning_conf</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="distillation.html" class="btn btn-neutral float-left" title="Distillation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="autodistillation.html" class="btn btn-neutral float-right" title="AutoDistillation Design" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Intel® Extension for Transformers, Intel.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   <jinja2.runtime.BlockReference object at 0x7f2adddfcac0> 
  <p></p><div><a href='https://www.intel.com/content/www/us/en/privacy/intel-cookie-notice.html' data-cookie-notice='true'>Cookies</a> <a href='https://www.intel.com/content/www/us/en/privacy/intel-privacy-notice.html'>| Privacy</a></div>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>